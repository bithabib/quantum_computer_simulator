<div class="row" style="height: 60vh; border: 1px solid #ccc;">
    <!-- <div class="col-md-12 mt-2"
        style="height: 10%; width: 100%; background-color: black; display: flex; justify-content: center;">
        <div id="constructive_1" style="height: 100%; width: 2px; background-color: red; margin-left: 2px;"></div>
        <div id="constructive_1" style="height: 100%; width: 2px; background-color: red; margin-right: 2px;"></div>
    </div> -->
    <div class="col-md-12 mt-2"
        style="height: 10%; width: 100%; background-color: black;display: flex; align-items: center; ">
        <div id="slitContainer" style="height: 100%; width: 100%; display: flex; justify-content: center;">

            <div id="constructive_1" style="height: 100%; width: 30px; display: flex; justify-content: center;">
                <div id="constructive_11"
                    style="height: 100%; width: 50%; background: linear-gradient(to left, rgba(255, 0, 0, 1) 20%, rgba(255, 0, 0, 0) 100%);">
                </div>
                <div id="constructive_12"
                    style="height: 100%; width: 50%; background: linear-gradient(to right, rgba(255, 0, 0, 1) 20%, rgba(255, 0, 0, 0) 100%);">
                </div>
            </div>
            <div id="constructive_2" style="height: 100%; width: 30px; display: flex; justify-content: center;">
                <div id="constructive_21"
                    style="height: 100%; width: 50%; background: linear-gradient(to left, rgba(255, 0, 0, 1) 20%, rgba(255, 0, 0, 0) 100%);">
                </div>
                <div id="constructive_22"
                    style="height: 100%; width: 50%; background: linear-gradient(to right, rgba(255, 0, 0, 1) 20%, rgba(255, 0, 0, 0) 100%);">
                </div>
            </div>
            <div id="constructive_3" style="height: 100%; width: 30px; display: flex; justify-content: center;">
                <div id="constructive_31"
                    style="height: 100%; width: 50%; background: linear-gradient(to left, rgba(255, 0, 0, 1) 20%, rgba(255, 0, 0, 0) 100%);">
                </div>
                <div id="constructive_32"
                    style="height: 100%; width: 50%; background: linear-gradient(to right, rgba(255, 0, 0, 1) 20%, rgba(255, 0, 0, 0) 100%);">
                </div>
            </div>
            <div id="constructive_4" style="height: 100%; width: 30px; display: flex; justify-content: center;">
                <div id="constructive_41"
                    style="height: 100%; width: 50%; background: linear-gradient(to left, rgba(255, 0, 0, 1) 20%, rgba(255, 0, 0, 0) 100%);">
                </div>
                <div id="constructive_42"
                    style="height: 100%; width: 50%; background: linear-gradient(to right, rgba(255, 0, 0, 1) 20%, rgba(255, 0, 0, 0) 100%);">
                </div>
            </div>
            <div id="constructive_5" style="height: 100%; width: 30px; display: flex; justify-content: center;">
                <div id="constructive_51"
                    style="height: 100%; width: 50%; background: linear-gradient(to left, rgba(255, 0, 0, 1) 20%, rgba(255, 0, 0, 0) 100%);">
                </div>
                <div id="constructive_52"
                    style="height: 100%; width: 50%; background: linear-gradient(to right, rgba(255, 0, 0, 1) 20%, rgba(255, 0, 0, 0) 100%);">
                </div>
            </div>
            <div id="constructive_6" style="height: 100%; width: 30px; display: flex; justify-content: center;">
                <div id="constructive_61"
                    style="height: 100%; width: 50%; background: linear-gradient(to left, rgba(255, 0, 0, 1) 20%, rgba(255, 0, 0, 0) 100%);">
                </div>
                <div id="constructive_62"
                    style="height: 100%; width: 50%; background: linear-gradient(to right, rgba(255, 0, 0, 1) 20%, rgba(255, 0, 0, 0) 100%);">
                </div>
            </div>
            <div id="constructive_7" style="height: 100%; width: 30px; display: flex; justify-content: center;">
                <div id="constructive_71"
                    style="height: 100%; width: 50%; background: linear-gradient(to left, rgba(255, 0, 0, 1) 20%, rgba(255, 0, 0, 0) 100%);">
                </div>
                <div id="constructive_72"
                    style="height: 100%; width: 50%; background: linear-gradient(to right, rgba(255, 0, 0, 1) 20%, rgba(255, 0, 0, 0) 100%);">
                </div>
            </div>
            <div id="constructive_8" style="height: 100%; width: 30px; display: flex; justify-content: center;">
                <div id="constructive_81"
                    style="height: 100%; width: 50%; background: linear-gradient(to left, rgba(255, 0, 0, 1) 20%, rgba(255, 0, 0, 0) 100%);">
                </div>
                <div id="constructive_82"
                    style="height: 100%; width: 50%; background: linear-gradient(to right, rgba(255, 0, 0, 1) 20%, rgba(255, 0, 0, 0) 100%);">
                </div>
            </div>
            <div id="constructive_9" style="height: 100%; width: 30px; display: flex; justify-content: center;">
                <div id="constructive_91"
                    style="height: 100%; width: 50%; background: linear-gradient(to left, rgba(255, 0, 0, 1) 20%, rgba(255, 0, 0, 0) 100%);">
                </div>
                <div id="constructive_92"
                    style="height: 100%; width: 50%; background: linear-gradient(to right, rgba(255, 0, 0, 1) 20%, rgba(255, 0, 0, 0) 100%);">
                </div>
            </div>
            <div id="constructive_10" style="height: 100%; width: 30px; display: flex; justify-content: center;">
                <div id="constructive_101"
                    style="height: 100%; width: 50%; background: linear-gradient(to left, rgba(255, 0, 0, 1) 20%, rgba(255, 0, 0, 0) 100%);">
                </div>
                <div id="constructive_102"
                    style="height: 100%; width: 50%; background: linear-gradient(to right, rgba(255, 0, 0, 1) 20%, rgba(255, 0, 0, 0) 100%);">
                </div>
            </div>
            <div id="constructive_11" style="height: 100%; width: 30px; display: flex; justify-content: center;">
                <div id="constructive_111"
                    style="height: 100%; width: 50%; background: linear-gradient(to left, rgba(255, 0, 0, 1) 20%, rgba(255, 0, 0, 0) 100%);">
                </div>
                <div id="constructive_112"
                    style="height: 100%; width: 50%; background: linear-gradient(to right, rgba(255, 0, 0, 1) 20%, rgba(255, 0, 0, 0) 100%);">
                </div>
            </div>
            <div id="constructive_12" style="height: 100%; width: 30px; display: flex; justify-content: center;">
                <div id="constructive_121"
                    style="height: 100%; width: 50%; background: linear-gradient(to left, rgba(255, 0, 0, 1) 20%, rgba(255, 0, 0, 0) 100%);">
                </div>
                <div id="constructive_122"
                    style="height: 100%; width: 50%; background: linear-gradient(to right, rgba(255, 0, 0, 1) 20%, rgba(255, 0, 0, 0) 100%);">
                </div>
            </div>
            <div id="constructive_13" style="height: 100%; width: 30px; display: flex; justify-content: center;">
                <div id="constructive_131"
                    style="height: 100%; width: 50%; background: linear-gradient(to left, rgba(255, 0, 0, 1) 20%, rgba(255, 0, 0, 0) 100%);">
                </div>
                <div id="constructive_132"
                    style="height: 100%; width: 50%; background: linear-gradient(to right, rgba(255, 0, 0, 1) 20%, rgba(255, 0, 0, 0) 100%);">
                </div>
            </div>
            <div id="constructive_14" style="height: 100%; width: 30px; display: flex; justify-content: center;">
                <div id="constructive_141"
                    style="height: 100%; width: 50%; background: linear-gradient(to left, rgba(255, 0, 0, 1) 20%, rgba(255, 0, 0, 0) 100%);">
                </div>
                <div id="constructive_142"
                    style="height: 100%; width: 50%; background: linear-gradient(to right, rgba(255, 0, 0, 1) 20%, rgba(255, 0, 0, 0) 100%);">
                </div>
            </div>
            <div id="constructive_15" style="height: 100%; width: 30px; display: flex; justify-content: center;">
                <div id="constructive_151"
                    style="height: 100%; width: 50%; background: linear-gradient(to left, rgba(255, 0, 0, 1) 20%, rgba(255, 0, 0, 0) 100%);">
                </div>
                <div id="constructive_152"
                    style="height: 100%; width: 50%; background: linear-gradient(to right, rgba(255, 0, 0, 1) 20%, rgba(255, 0, 0, 0) 100%);">
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-12 mt-2" style="height: 50%; width: 100%;">
        <canvas id="waveCanvas" style="height: 100%; width: 100%;"></canvas>



    </div>


    <div class="col-md-12 mt-2"
        style="height: 10%; width: 100%; background-color: black;display: flex; align-items: center; ">
        <div id="slitContainer" style="height: 100%; width: 100%; display: flex; justify-content: center;">
            <div id="slit_1" style="height: 100%; width: 2px; background-color: red; margin-right: 2px;"></div>
            <div id="slit_2" style="height: 100%; width: 2px; background-color: red; margin-left: 2px;"></div>
        </div>
    </div>

    <div class="col-md-12 mt-2">
        <input type="range" min="2" max="30" value="2" id="distance_bitween_two_slits">
        <label for="distance_bitween_two_slits">Distance between slits (micrometers)</label>
        <input type="range" min="5" max="20" value="2" id="slit_width">
        <label for="slit_width">Slit width (micrometers)</label>
        <input type="range" min="2" max="20" value="2" id="screen_distance">
        <label for="screen_distance">Distance to the screen (meters)</label>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            console.log("DOM fully loaded and parsed");
            var slit1 = document.getElementById("slit_1");
            var slit2 = document.getElementById("slit_2");
            slitDistanceWidthHandler(document.getElementById("slit_width"), document.getElementById("distance_bitween_two_slits"), document.getElementById("screen_distance"));
            // JavaScript to adjust the gap between slit_1 and slit_2
            var distance_bitween_two_slits = document.getElementById("distance_bitween_two_slits");
            distance_bitween_two_slits.addEventListener("input", function () {
                var distance = this.value; // Get the value of the slider
                slit1.style.marginRight = distance + "px"; // Set margin-right for slit_1
                slit2.style.marginLeft = distance + "px"; // Set margin-left for slit_2
                slitDistanceWidthHandler(document.getElementById("slit_width"), this, document.getElementById("screen_distance"));
            });

            // JavaScript to adjust the width of the slits
            var slit_width = document.getElementById("slit_width");
            slit_width.addEventListener("input", function () {
                slitDistanceWidthHandler(this, document.getElementById("distance_bitween_two_slits"), document.getElementById("screen_distance"));
            });

            // JavaScript to adjust the distance to the screen
            var screen_distance = document.getElementById("screen_distance");
            screen_distance.addEventListener("input", function () {
                slitDistanceWidthHandler(document.getElementById("slit_width"), document.getElementById("distance_bitween_two_slits"), this);
            });


            var canvas = document.getElementById('waveCanvas');
            // var myChart = null;
            // get canvas width and height


            // Function to calculate intensity at a given point (x) on the screen
            function intensity(x, wavelength, slitSeparation, screenDistance) {
                const k = 2 * Math.PI / wavelength;
                const d = slitSeparation;
                const D = screenDistance;
                const r1 = Math.sqrt(x * x + D * D);
                const r2 = Math.sqrt((x - d) * (x - d) + D * D);
                const phi = k * r1 - k * r2;
                return Math.pow(Math.cos(phi), 2);
            }

            // Function to calculate combined intensity at a given point (x) on the screen
            function combinedIntensity(x, wavelength, slitSeparation, screenDistance) {
                return intensity(x, wavelength, slitSeparation, screenDistance) + intensity(x - slitSeparation, wavelength, slitSeparation, screenDistance);
            }
            function slitDistanceWidthHandler(widthEventHandler, distanceEventHandler, screenDistanceEventHandler) {
                var width = widthEventHandler.value; // Get the value of the slider
                var distanceSplit = distanceEventHandler.value; // Get the value of the slider
                var sDistance = screenDistanceEventHandler.value; // Get the value of the slider
                slit1.style.width = width + "px"; // Set width for slit_1
                slit2.style.width = width + "px"; // Set width for slit_2
                console.log(distanceSplit);
                const canvasWidth = 800;
                const canvasHeight = 400;
                const scale = 100; // Scale for drawing
                const wavelength = 0.02 + (width / 1000); // Wavelength of the waves
                const slitSeparation = 0.2 + (distanceSplit / 100); // Distance between the slits
                const screenDistance = 1 + (sDistance/10); // Distance from the slits to the screen
                var labels = [];
                var intensityData = [];
                for (let x = 0; x < canvasWidth; x++) {
                    const intensityValue = combinedIntensity((x - canvasWidth / 2) / scale, wavelength, slitSeparation, screenDistance);
                    const y = canvasHeight / 2 - intensityValue * scale;
                    labels.push(x);
                    intensityData.push(y);
                }
                // line chart 
                var downGradeBy = canvasWidth / 15;
                var downsampledlabels = _.chunk(labels, downGradeBy).map(chunk => _.mean(chunk));
                var downsampledintensityData = _.chunk(intensityData, downGradeBy).map(chunk => _.mean(chunk));
                // find max intensity
                var maxIntensity = Math.max(...downsampledintensityData);
                for (var i = 1; i <= 15; i++) {
                    var constructive1 = document.getElementById("constructive_" + i + "1");
                    var constructive2 = document.getElementById("constructive_" + i + "2");
                    var increaseIntensity = 255 - maxIntensity;
                    var intensity = downsampledintensityData[i - 1] + increaseIntensity;

                    constructive1.style.background = "linear-gradient(to left, rgba(" + intensity + ", 0, 0, 1) 20%, rgba(" + intensity + ", 0, 0, 0) 100%)";
                    constructive2.style.background = "linear-gradient(to right, rgba(" + intensity + ", 0, 0, 1) 20%, rgba(" + intensity + ", 0, 0, 0) 100%)";
                }
                createChart(labels, intensityData);
            }
            var myChart;
            function createChart(labels, intensityData) {
                if (!myChart) {
                    myChart = new Chart($("#waveCanvas"), {
                        type: 'line',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'My Dataset',
                                data: intensityData,// End data 
                                borderColor: 'green',
                                fill: false,
                                tension: 0.01,
                                pointRadius: 0,
                            }]// End datasets 
                        },// End data
                        options: {
                            Plugins: {
                                zoom: {
                                    zoom: {
                                        wheel: {
                                            enabled: true,
                                        },
                                        pinch: {
                                            enabled: true,
                                        },
                                        mode: 'x',
                                    }
                                }
                            }
                        }
                    });

                }
                else {
                    myChart.data.labels = labels;
                    myChart.data.datasets[0].data = intensityData;
                    myChart.update();
                }

            }

        });
    </script>

    <div class="col-md-12 mt-2" style="height: 30%; width: 100%;">

    </div>


</div>